{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./resources/assets/dcat/extra/upload.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","w","$","Uploader","opts","extend","wrapper","addFileButton","inputSelector","isImage","preview","server","updateServer","autoUpload","sortable","deleteUrl","deleteData","thumbHeight","disabled","autoUpdateColumn","disableRemove","dimensions","lang","exceed_size","interrupt","upload_failed","selected_files","selected_has_failed","selected_success","dot","failed_num","pause_upload","go_on_upload","start_upload","upload_success_message","go_on_add","Q_TYPE_DENIED","Q_EXCEED_NUM_LIMIT","F_EXCEED_SIZE","Q_EXCEED_SIZE_LIMIT","F_DUPLICATE","confirm_delete_file","upload","formData","_id","thumb","width","height","quality","allowMagnify","crop","preserveHeaders","type","$selector","selector","updateColumn","upload_column","Math","floor","random","relation","_relation","elementName","$wrap","$queue","$statusBar","$info","$upload","$placeHolder","$progress","uploader","initImg","data","support","Dcat","showImg","originalFilesNum","helpers","len","$input","find","getFileViewSelector","fileId","replace","getFileView","addFileButtonSelector","faildFiles","formFiles","fileCount","fileSize","state","percentages","isSupportBase64","Image","onload","onerror","this","src","flashVersion","version","navigator","plugins","description","ex","ActiveXObject","GetVariable","ex2","match","parseFloat","file","Translator","__","trans","uploadedFiles","addFile","$li","$btns","size","WebUploader","formatSize","fileName","id","ext","toUpperCase","appendTo","nam","showError","code","text","setTimeout","css","margin","getStatus","statusText","image","makeThumb","error","img","empty","show","append","once","_info","info","_meta","meta","isset","validateDimensions","removeFile","resize","e","rotation","on","cur","prev","hide","remove","removeClass","addClass","deleteInput","serverId","confirm","post","_column","loading","url","success","result","status","message","previewImage","attr","orderFiles","apply","removeUploadFile","updateTotalProgress","off","end","percent","loaded","total","$bar","each","k","v","round","updateStatusText","stats","showSuccess","getStats","successNum","num","uploadFailNum","fail","html","setState","val","args","removeAttr","refreshButton","removeValidatorErrors","fileNumLimit","request","numOfSuccess","location","reload","fileLimit","option","removeFormFile","fake","getInput","split","addInput","push","setInput","arr","filter","self","indexOf","join","trigger","appendUploadedFile","searchUploadedFile","swrapUploadedFile","order","index","parseInt","currentFile","prevFile","nextFile","files","syncUploadedFiles","rerenderUploadedFiles","appendUploadedFileForm","refresh","parents","$this","first","$prev","$next","next","length","serverPath","serverUrl","deleteFile","click","options","build","browser","ie","container","window","swf","supportIe","items","denied","addButton","label","onUploadProgress","percentage","onBeforeFileQueued","onFileQueued","onFileDequeued","obj","reason","values","form","updateFileColumn","errorMessage","merge","serverName","path","onError","warning","hasClass","stop","retry","pop","addFileView","removeUploadFileView","getColumn","jQuery"],"mappings":"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","file":"/resources/dist/dcat/extra/upload.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n","(function (w, $) {\n    function Uploader(opts) {\n        opts = $.extend({\n            wrapper: '.web-uploader', // 图片显示容器选择器\n            addFileButton: '.add-file-button', // 继续添加按钮选择器\n            inputSelector: '',\n            isImage: false,\n            preview: [], // 数据预览\n            server: '',\n            updateServer: '',\n            autoUpload: false,\n            sortable: false,\n            deleteUrl: '',\n            deleteData: {},\n            thumbHeight: 160,\n            disabled: false, // 禁止任何上传编辑\n            autoUpdateColumn: false,\n            disableRemove: false, // 禁止删除图片，允许替换\n            dimensions: {\n                // width: 100, // 图片宽限制\n                // height: 100, // 图片高限制\n                // min_width: 100, //\n                // min_height: 100,\n                // max_width: 100,\n                // max_height: 100,\n                // ratio: 3/2, // 宽高比\n            },\n            lang: {\n                exceed_size: '文件大小超出',\n                interrupt: '上传暂停',\n                upload_failed: '上传失败，请重试',\n                selected_files: '选中:num个文件，共:size。',\n                selected_has_failed: '已成功上传:success个文件，:fail个文件上传失败，<a class=\"retry\"  href=\"javascript:\"\";\">重新上传</a>失败文件或<a class=\"ignore\" href=\"javascript:\"\";\">忽略</a>',\n                selected_success: '共:num个(:size)，已上传:success个。',\n                dot: '，',\n                failed_num: '失败:fail个。',\n                pause_upload: '暂停上传',\n                go_on_upload: '继续上传',\n                start_upload: '开始上传',\n                upload_success_message: '已成功上传:success个文件',\n                go_on_add: '继续添加',\n                Q_TYPE_DENIED: '对不起，不允许上传此类型文件',\n                Q_EXCEED_NUM_LIMIT: '对不起，已超出文件上传数量限制，最多只能上传:num个文件',\n                F_EXCEED_SIZE: '对不起，当前选择的文件过大',\n                Q_EXCEED_SIZE_LIMIT: '对不起，已超出文件大小限制',\n                F_DUPLICATE: '文件重复',\n                confirm_delete_file: '您确定要删除这个文件吗？',\n            },\n            upload: { // web-uploader配置\n                formData: {\n                    _id: null, // 唯一id\n                },\n                thumb: {\n                    width: 160,\n                    height: 160,\n                    quality: 70,\n                    allowMagnify: true,\n                    crop: true,\n                    preserveHeaders: false,\n                    // 为空的话则保留原有图片格式。\n                    // 否则强制转换成指定的类型。\n                    // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\n                    // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\n                    type: 'image/jpeg'\n                },\n            }\n        }, opts);\n\n        var $selector = $(opts.selector),\n            updateColumn = opts.upload.formData.upload_column || ('webup' + Math.floor(Math.random() * 10000)),\n            relation = opts.upload.formData._relation, // 一对多关联关系名称\n            elementName = opts.elementName;\n\n        if (typeof opts.upload.formData._id == \"undefined\" || !opts.upload.formData._id) {\n            opts.upload.formData._id = updateColumn + Math.floor(Math.random() * 10000);\n        }\n\n        let Dcat = w.Dcat,\n\n            $wrap,\n\n            // 展示图片\n            showImg = opts.isImage,\n\n            // 图片容器\n            $queue,\n\n            // 状态栏，包括进度和控制按钮\n            $statusBar,\n\n            // 文件总体选择信息。\n            $info,\n\n            // 上传按钮\n            $upload,\n\n            // 没选择文件之前的内容。\n            $placeHolder,\n\n            $progress,\n\n            // 已上传文件数量\n            originalFilesNum = Dcat.helpers.len(opts.preview),\n\n            // 上传表单\n            $input = $selector.find(opts.inputSelector),\n\n            // 获取文件视图选择器\n            getFileViewSelector = function (fileId) {\n                return elementName.replace(/[\\[\\]]*/g, '_') + '-' + fileId;\n            },\n\n            getFileView = function (fileId) {\n                return $('#' + getFileViewSelector(fileId));\n            },\n\n            // 继续添加按钮选择器\n            addFileButtonSelector = opts.addFileButton,\n\n            // 临时存储上传失败的文件，key为file id\n            faildFiles = {},\n\n            // 临时存储添加到form表单的文件\n            formFiles = {},\n\n            // 添加的文件数量\n            fileCount = 0,\n\n            // 添加的文件总大小\n            fileSize = 0,\n\n            // 可能有pedding, ready, uploading, confirm, done.\n            state = 'pedding',\n\n            // 所有文件的进度信息，key为file id\n            percentages = {},\n            // 判断浏览器是否支持图片的base64\n            isSupportBase64 = (function () {\n                var data = new Image();\n                var support = true;\n                data.onload = data.onerror = function () {\n                    if (this.width != 1 || this.height != 1) {\n                        support = false;\n                    }\n                };\n                data.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\n                return support;\n            })(),\n\n            // 检测是否已经安装flash，检测flash的版本\n            flashVersion = (function () {\n                var version;\n\n                try {\n                    version = navigator.plugins['Shockwave Flash'];\n                    version = version.description;\n                } catch (ex) {\n                    try {\n                        version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\n                            .GetVariable('$version');\n                    } catch (ex2) {\n                        version = '0.0';\n                    }\n                }\n                version = version.match(/\\d+/g);\n                return parseFloat(version[0] + '.' + version[1], 10);\n            })(),\n\n            // 判断是否是图片\n            isImage = function (file) {\n                return file.type.match(/^image/);\n            },\n\n            // 翻译\n            lang = Dcat.Translator(opts.lang),\n            __ = lang.trans.bind(lang),\n\n            // WebUploader实例\n            uploader,\n\n            // 已上传的文件\n            uploadedFiles = [],\n\n            initImg;\n\n        // 当有文件添加进来时执行，负责view的创建\n        function addFile(file) {\n            var size = WebUploader.formatSize(file.size), $li, $btns, fileName = file.name || null;\n\n            if (showImg) {\n                $li = $(`<li id=\"${getFileViewSelector(file.id)}\" title=\"${fileName}\" >\n                    <p class=\"file-type\">${(file.ext.toUpperCase() || 'FILE')}</p>\n                    <p class=\"imgWrap \"></p>\n                    <p class=\"title\" style=\"\">${file.name}</p>\n                    <p class=\"title\" style=\"margin-bottom:20px;\">(<b>${size}</b>)</p>\n                    </li>`);\n\n                $btns = $(`<div class=\"file-panel\">\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"cancel\"><i class=\"feather icon-x red-dark\" style=\"font-size:13px\"></i></a>\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"delete\" style=\"display: none\">\n                    <i class=\"feather icon-trash red-dark\" style=\"font-size:13px\"></i></a>\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"preview\" ><i class=\"feather icon-zoom-in\"></i></a>\n                    <a class='btn btn-sm btn-white' data-file-act='order' data-order=\"1\" style=\"display: none\"><i class='feather icon-arrow-up'></i></a>\n                    <a class='btn btn-sm btn-white' data-file-act='order' data-order=\"0\" style=\"display: none\"><i class='feather icon-arrow-down'></i></a>\n\n                    </div>`).appendTo($li);\n            } else {\n                $li = $(`\n                    <li id=\"${getFileViewSelector(file.id)}\" title=\"${file.nam}\">\n                    <p class=\"title\" style=\"display:block\">\n                        <i class=\"feather icon-check green _success icon-success\"></i>\n                        ${file.name} (${size})\n                    </p>\n                    </li>\n                `);\n\n                $btns = $(`\n<span style=\"right: 45px;\" class=\"file-action d-none\" data-file-act='order' data-order=\"1\"><i class='feather icon-arrow-up'></i></span>\n<span style=\"right: 25px;\" class=\"file-action d-none\" data-file-act='order' data-order=\"0\"><i class='feather icon-arrow-down'></i></span>\n<span data-file-act=\"cancel\" class=\"file-action\" style=\"font-size:13px\">\n    <i class=\"feather icon-x red-dark\"></i>\n</span>\n<span data-file-act=\"delete\" class=\"file-action\" style=\"display:none\">\n    <i class=\"feather icon-trash red-dark\"></i>\n</span>\n`).appendTo($li);\n            }\n\n            var $wrap = $li.find('p.imgWrap'),\n                $info = $('<p class=\"error\"></p>'),\n\n                showError = function (code, file) {\n                    var text = '';\n                    switch (code) {\n                        case 'exceed_size':\n                            text = __('exceed_size');\n                            break;\n\n                        case 'interrupt':\n                            text = __('interrupt');\n                            break;\n\n                        default:\n                            text = __('upload_failed');\n                            break;\n                    }\n\n                    faildFiles[file.id] = file;\n\n                    $info.text(text).appendTo($li);\n                };\n\n            $li.appendTo($queue);\n\n            setTimeout(function () {\n                $li.css({margin: '5px'});\n            }, 50);\n\n            if (file.getStatus() === 'invalid') {\n                showError(file.statusText, file);\n            } else {\n                if (showImg) {\n                    var image = uploader.makeThumb(file, function (error, src) {\n                        var img;\n\n                        $wrap.empty();\n                        if (error) {\n                            $li.find('.title').show();\n                            $li.find('.file-type').show();\n                            return;\n                        }\n\n                        if (isSupportBase64) {\n                            img = $('<img src=\"' + src + '\">');\n                            $wrap.append(img);\n                        } else {\n                            $li.find('.file-type').show();\n                        }\n                    });\n\n                    try {\n                        image.once('load', function () {\n                            file._info = file._info || image.info();\n                            file._meta = file._meta || image.meta();\n                            var width = file._info.width,\n                                height = file._info.height;\n\n                            if (!validateDimensions(file)) {\n                                Dcat.error('The image dimensions is invalid.');\n                                uploader.removeFile(file);\n                                return false;\n                            }\n\n                            image.resize(width, height);\n                        });\n                    } catch (e) {\n                        // 不是图片\n                        return setTimeout(function () {\n                            uploader.removeFile(file);\n                        }, 10);\n                    }\n                }\n\n                percentages[file.id] = [file.size, 0];\n                file.rotation = 0;\n            }\n\n            file.on('statuschange', function (cur, prev) {\n                if (prev === 'progress') {\n                    // $prgress.hide().width(0);\n                } else if (prev === 'queued') {\n                    $btns.find('[data-file-act=\"cancel\"]').hide();\n                    $btns.find('[data-file-act=\"delete\"]').show();\n                }\n\n                // 成功\n                if (cur === 'error' || cur === 'invalid') {\n                    showError(file.statusText, file);\n                    percentages[file.id][1] = 1;\n                } else if (cur === 'interrupt') {\n                    showError('interrupt', file);\n                } else if (cur === 'queued') {\n                    percentages[file.id][1] = 0;\n                } else if (cur === 'progress') {\n                    $info.remove();\n                    // $prgress.css('display', 'block');\n                } else if (cur === 'complete') {\n                    if (showImg) {\n                        $li.append('<span class=\"success\"><em></em><i class=\"feather icon-check\"></i></span>');\n                    } else {\n                        $li.find('._success').show();\n                    }\n                }\n\n                $li.removeClass('state-' + prev).addClass('state-' + cur);\n            });\n\n            var $act = showImg ? $btns.find('a') : $btns;\n\n            $act.on('click', function () {\n                var index = $(this).data('file-act');\n\n                switch (index) {\n                    case 'cancel':\n                        uploader.removeFile(file);\n                        return;\n                    case 'deleteurl':\n                    case 'delete':\n                        if (opts.disableRemove) {\n                            deleteInput(file.serverId);\n                            return uploader.removeFile(file);\n                        }\n\n                        Dcat.confirm(__('confirm_delete_file'), file.serverId, function () {\n                            var post = opts.deleteData;\n\n                            post.key = file.serverId;\n                            if (!post.key) {\n                                deleteInput(file.serverId);\n                                return uploader.removeFile(file);\n                            }\n                            post._column = updateColumn;\n                            post._relation = relation;\n\n                            Dcat.loading();\n                            $.post({\n                                url: opts.deleteUrl,\n                                data: post,\n                                success: function (result) {\n                                    Dcat.loading(false);\n                                    if (result.status) {\n                                        deleteInput(file.serverId);\n                                        uploader.removeFile(file);\n                                        return;\n                                    }\n\n                                    Dcat.error(result.message || 'Remove file failed.');\n                                }\n                            });\n\n                        });\n\n                        break;\n                    case 'preview':\n                        Dcat.helpers.previewImage($wrap.find('img').attr('src'), null, file.name);\n                        break;\n                    case 'order':\n                        $(this).attr('data-id', file.serverId);\n\n                        orderFiles.apply(this);\n                        break;\n                }\n\n            });\n        }\n\n        // 图片宽高验证\n        function validateDimensions(file) {\n            // The image dimensions is invalid.\n            if (!showImg || !isImage(file) || !Dcat.helpers.len(opts.dimensions)) return true;\n            var dimensions = opts.dimensions,\n                width = file._info.width,\n                height = file._info.height,\n                isset = Dcat.helpers.isset;\n            if (\n                (isset(dimensions, 'width') && dimensions['width'] != width) ||\n                (isset(dimensions, 'min_width') && dimensions['min_width'] > width) ||\n                (isset(dimensions, 'max_width') && dimensions['max_width'] < width) ||\n                (isset(dimensions, 'height') && dimensions['height'] != height) ||\n                (isset(dimensions, 'min_height') && dimensions['min_height'] > height) ||\n                (isset(dimensions, 'max_height') && dimensions['max_height'] < height) ||\n                (isset(dimensions, 'ratio') && dimensions['ratio'] != (width / height))\n            ) {\n                return false;\n            }\n\n            return true;\n        }\n\n        // 负责view的销毁\n        function removeUploadFile(file) {\n            var $li = getFileView(file.id);\n\n            delete percentages[file.id];\n            updateTotalProgress();\n            $li.off().find('.file-panel').off().end().remove();\n        }\n\n        function updateTotalProgress() {\n            var loaded = 0,\n                total = 0,\n                $bar = $progress.find('.progress-bar'),\n                percent;\n\n            $.each(percentages, function (k, v) {\n                total += v[0];\n                loaded += v[0] * v[1];\n            });\n\n            percent = total ? loaded / total : 0;\n            percent = Math.round(percent * 100) + '%';\n\n            $bar.text(percent);\n            $bar.css('width', percent);\n            updateStatusText();\n        }\n\n        function updateStatusText() {\n            var text = '', stats;\n\n            if (!uploader) {\n                return;\n            }\n\n            if (state === 'ready') {\n                stats = uploader.getStats();\n                if (fileCount) {\n                    text = __('selected_files', {num: fileCount, size: WebUploader.formatSize(fileSize)});\n                } else {\n                    showSuccess();\n                }\n            } else if (state === 'confirm') {\n                stats = uploader.getStats();\n                if (stats.uploadFailNum) {\n                    text = __('selected_has_failed', {success: stats.successNum, fail: stats.uploadFailNum});\n                }\n            } else {\n                showSuccess();\n            }\n\n            function showSuccess() {\n                stats = uploader.getStats();\n                if (stats.successNum) {\n                    text = __('selected_success', {num: fileCount, size: WebUploader.formatSize(fileSize), success: stats.successNum});\n                }\n\n                if (stats.uploadFailNum) {\n                    text += (text ? __('dot') : '') + __('failed_num', {fail: stats.uploadFailNum});\n                }\n            }\n\n            $info.html(text);\n        }\n\n        // 上传文件后修改字段值\n        function updateFileColumn() {\n            var values = getInput(),\n                num = uploader.getStats().successNum,\n                form = $.extend({}, opts.formData);\n\n            if (!num || !values || !opts.autoUpdateColumn) {\n                return;\n            }\n\n            if (relation) {\n                if (!relation[1]) {\n                    // 新增子表记录，则不调用update接口\n                    return;\n                }\n\n                form[relation[0]] = {};\n\n                form[relation[0]][relation[1]] = {};\n                form[relation[0]][relation[1]][updateColumn] = values.join(',');\n            } else {\n                form[updateColumn] = values.join(',');\n            }\n\n            delete form['_relation'];\n            delete form['upload_column'];\n\n            $.post({\n                url: opts.updateServer,\n                data: form,\n            });\n        }\n\n        function setState(val, args) {\n            var stats;\n            args = args || {};\n\n            if (val === state) {\n                return;\n            }\n\n            if ($upload) {\n                $upload.removeClass('state-' + state);\n                $upload.addClass('state-' + val);\n            }\n            state = val;\n\n            switch (state) {\n                case 'pedding':\n                    if (opts.disabled) return;\n                    $placeHolder.removeClass('element-invisible');\n                    $queue.hide();\n                    $statusBar.addClass('element-invisible');\n                    if (showImg) {\n                        $wrap.removeAttr('style');\n                        $wrap.find('.queueList').removeAttr('style');\n                    }\n\n                    refreshButton();\n                    break;\n\n                case 'ready':\n                    $placeHolder.addClass('element-invisible');\n                    $selector.find(addFileButtonSelector).removeClass('element-invisible');\n                    $queue.show();\n                    if (!opts.disabled) {\n                        $statusBar.removeClass('element-invisible');\n                    }\n                    refreshButton();\n                    if (showImg) {\n                        $wrap.find('.queueList').css({'border': '1px solid #d3dde5', 'padding': '5px'});\n                        // $wrap.find('.queueList').removeAttr('style');\n                    }\n\n                    setTimeout(removeValidatorErrors, 1);\n                    break;\n\n                case 'uploading':\n                    $selector.find(addFileButtonSelector).addClass('element-invisible');\n                    $progress.show();\n                    $upload.text(__('pause_upload'));\n                    break;\n\n                case 'paused':\n                    $progress.show();\n                    $upload.text(__('go_on_upload'));\n                    break;\n\n                case 'confirm':\n                    if (uploader) {\n                        $progress.hide();\n                        $selector.find(addFileButtonSelector).removeClass('element-invisible');\n                        $upload.text(__('start_upload'));\n\n                        stats = uploader.getStats();\n                        if (stats.successNum && !stats.uploadFailNum) {\n                            setState('finish');\n                            return;\n                        }\n                    }\n                    break;\n                case 'finish':\n                    if (uploader) {\n                        stats = uploader.getStats();\n                        if (stats.successNum) {\n                            Dcat.success(__('upload_success_message', {success: stats.successNum}));\n\n                            setTimeout(function () {\n                                if (opts.upload.fileNumLimit == 1) {\n                                    // 单文件上传，需要重置文件上传个数\n                                    uploader.request('get-stats').numOfSuccess = 0;\n                                }\n                            }, 10);\n\n                        } else {\n                            // 没有成功的图片，重设\n                            state = 'done';\n                            location.reload();\n                        }\n                    }\n                    break;\n                case 'decrOriginalFileNum':\n                    if (originalFilesNum > 0) originalFilesNum--;\n                    break;\n\n                case 'incrOriginalFileNum':\n                    originalFilesNum++;\n                    break;\n\n                case 'decrFileNumLimit': // 减少上传文件数量限制\n                    if (!uploader) {\n                        return;\n                    }\n                    var fileLimit = uploader.option('fileNumLimit'),\n                        num = args.num || 1;\n\n                    if (fileLimit == '-1') fileLimit = 0;\n\n                    num = fileLimit >= num ? fileLimit - num : 0;\n\n                    if (num == 0) num = '-1';\n\n                    uploader.option('fileNumLimit', num);\n\n                    break;\n                case 'incrFileNumLimit': // 增加上传文件数量限制\n                    if (!uploader) {\n                        return;\n                    }\n                    var fileLimit = uploader.option('fileNumLimit'),\n                        num = args.num || 1;\n\n                    if (fileLimit == '-1') fileLimit = 0;\n\n                    num = fileLimit + num;\n\n                    uploader.option('fileNumLimit', num);\n                    break;\n                case 'init': // 初始化\n                    $upload.addClass('state-' + state);\n                    updateTotalProgress();\n\n                    if (originalFilesNum || opts.disabled) {\n                        $placeHolder.addClass('element-invisible');\n                        if (!opts.disabled) {\n                            $statusBar.show();\n                        } else {\n                            $wrap.addClass('disabled');\n                        }\n                        setState('ready');\n                    } else if (showImg) {\n                        $wrap.removeAttr('style');\n                        $wrap.find('.queueList').css('margin', '0');\n                    }\n                    refreshButton();\n                    break;\n\n            }\n\n            updateStatusText();\n        }\n\n        // 移除form表单的文件\n        function removeFormFile(fileId) {\n            if (!fileId) return;\n\n            var file = formFiles[fileId];\n\n            deleteInput(fileId);\n            delete formFiles[fileId];\n            if (uploader && !file.fake) {\n                uploader.removeFile(file);\n            }\n\n            setState('decrOriginalFileNum');\n            setState('incrFileNumLimit');\n\n            if (!Dcat.helpers.len(formFiles) && !Dcat.helpers.len(percentages)) {\n                setState('pedding');\n            }\n        }\n\n        // 获取表单值\n        function getInput() {\n            var val = $input.val();\n\n            return val ? val.split(',') : [];\n        }\n\n        // 新增表单值\n        function addInput(id) {\n            var val = getInput();\n            val.push(id);\n            setInput(val);\n        }\n\n        // 设置表单值\n        function setInput(arr) {\n            arr = arr.filter(function (v, k, self) {\n                return self.indexOf(v) === k;\n            }).filter(function (v) {\n                return v ? true : false;\n            });\n\n            // 手动触发change事件，方便监听文件变化\n            $input.val(arr.join(',')).trigger('change');\n        }\n\n        // 删除表单值\n        function deleteInput(id) {\n            deleteUploadedFile(id);\n\n            if (!id) {\n                return $input.val('');\n            }\n            setInput(getInput().filter(function (v) {\n                return v != id;\n            }));\n        }\n\n        // 添加已上传文件\n        function appendUploadedFile(file) {\n            if (!file.serverId || searchUploadedFile(file.serverId) !== -1) {\n                return;\n            }\n\n            uploadedFiles.push(file)\n        }\n\n        function syncUploadedFiles() {\n            var files = [];\n            for (var i in uploadedFiles) {\n                if (uploadedFiles[i]) {\n                    files.push(uploadedFiles[i].serverId);\n                }\n            }\n\n            setInput(files);\n        }\n\n        function deleteUploadedFile(fileId) {\n            uploadedFiles = uploadedFiles.filter(function (v) {\n                return v.serverId != fileId;\n            });\n        }\n\n        // 查找文件位置\n        function searchUploadedFile(fileId) {\n            for (var i in uploadedFiles) {\n                if (uploadedFiles[i].serverId === fileId) {\n                    return i;\n                }\n            }\n\n            return -1;\n        }\n\n        // 交换文件排序\n        function swrapUploadedFile(fileId, order) {\n            var index = parseInt(searchUploadedFile(fileId)),\n                currentFile = uploadedFiles[index],\n                prevFile = uploadedFiles[index - 1],\n                nextFile = uploadedFiles[index + 1];\n\n            if (order) {\n                if (index === 0) {\n                    return;\n                }\n\n                uploadedFiles[index - 1] = currentFile;\n                uploadedFiles[index] = prevFile;\n            } else {\n                if (!nextFile) {\n                    return;\n                }\n\n                uploadedFiles[index + 1] = currentFile;\n                uploadedFiles[index] = nextFile;\n            }\n\n            syncUploadedFiles();\n        }\n\n        // 重新渲染已上传文件\n        function rerenderUploadedFiles() {\n            $queue.html('');\n\n            for (var i in uploadedFiles) {\n                if (uploadedFiles[i]) {\n                    appendUploadedFileForm(uploadedFiles[i])\n                }\n            }\n        }\n\n        // 重新计算按钮定位\n        function refreshButton() {\n            uploader.refresh();\n        }\n\n        function removeValidatorErrors() {\n            $input.parents('.form-group,.form-label-group,.form-field').find('.with-errors').html('')\n        }\n\n        // 文件排序\n        function orderFiles() {\n            var $this = $(this),\n                $li = $this.parents('li').first(),\n                fileId = $this.data('id'),\n                order = $this.data('order'),\n                $prev = $li.prev(),\n                $next = $li.next();\n\n            if (order) {\n                // 升序\n                if (!$prev.length) {\n                    return;\n                }\n                swrapUploadedFile(fileId, order);\n                rerenderUploadedFiles();\n\n                return;\n            }\n\n            if (!$next.length) {\n                return;\n            }\n\n            swrapUploadedFile(fileId, order);\n            rerenderUploadedFiles();\n        }\n\n        // 添加上传成功文件到表单区域\n        function appendUploadedFileForm(file) {\n            var html = \"\";\n            html += \"<li title='\" + file.serverPath + \"'>\";\n\n            if (!showImg && opts.sortable) {\n                // 文件排序\n                html += `\n<p style=\"right: 45px\" class=\"file-action\" data-file-act='order' data-order=\"1\" data-id='${file.serverId}'><i class='feather icon-arrow-up'></i></p>\n<p style=\"right: 25px\" class=\"file-action\" data-file-act='order' data-order=\"0\" data-id='${file.serverId}'><i class='feather icon-arrow-down'></i></p>\n`;\n            }\n\n            if (showImg) {\n                html += `<p class='imgWrap'><img src='${file.serverUrl}'></p>`\n            } else if (!opts.disabled) {\n                html += `<p class=\"file-action\" data-file-act=\"delete\" data-id=\"${file.serverId}\"><i class=\"feather icon-trash red-dark\"></i></p>`;\n            }\n\n            html += \"<p class='title' style=''><i class='feather icon-check text-white icon-success text-white'></i>\";\n            html += file.serverPath;\n            html += \"</p>\";\n\n            if (showImg) {\n                html += \"<p class='title' style='margin-bottom:20px;'>&nbsp;</p>\";\n                html += \"<div class='file-panel' >\";\n\n                if (!opts.disabled) {\n                    html += `<a class='btn btn-sm btn-white' data-file-act='deleteurl' data-id='${file.serverId}'><i class='feather icon-trash red-dark' style='font-size:13px'></i></a>`;\n                }\n                html += `<a class='btn btn-sm btn-white' data-file-act='preview' data-url='${file.serverUrl}' ><i class='feather icon-zoom-in'></i></a>`;\n\n                if (opts.sortable) {\n                    // 文件排序\n                    html += `\n<a class='btn btn-sm btn-white' data-file-act='order' data-order=\"1\" data-id='${file.serverId}'><i class='feather icon-arrow-up'></i></a>\n<a class='btn btn-sm btn-white' data-file-act='order' data-order=\"0\" data-id='${file.serverId}'><i class='feather icon-arrow-down'></i></a>\n`;\n                }\n\n                html += \"</div>\";\n            } else {\n\n            }\n\n            html += \"</li>\";\n            html = $(html);\n\n            if (!showImg) {\n                html.find('.file-type').show();\n                html.find('.title').show();\n                $wrap.css('background', 'transparent');\n            }\n\n            var deleteFile = function () {\n                var fileId = $(this).data('id'), post = opts.deleteData;\n\n                if (opts.disableRemove) {\n                    html.remove();\n\n                    return removeFormFile(fileId);\n                }\n\n                Dcat.confirm(__('confirm_delete_file'), file.serverId, function () {\n                    post.key = fileId;\n                    post._column = updateColumn;\n                    post._relation = relation;\n\n                    Dcat.loading();\n                    $.post({\n                        url: opts.deleteUrl,\n                        data: post,\n                        success: function (result) {\n                            Dcat.loading(false);\n                            if (result.status) {\n                                // 移除\n                                html.remove();\n\n                                removeFormFile(fileId);\n                                return;\n                            }\n\n                            Dcat.error(result.message || 'Remove file failed.')\n                        }\n                    });\n                });\n            };\n\n            // 删除按钮点击事件\n            html.find('[data-file-act=\"deleteurl\"]').click(deleteFile);\n            html.find('[data-file-act=\"delete\"]').click(deleteFile);\n\n            // 文件排序\n            if (opts.sortable) {\n                html.find('[data-file-act=\"order\"').click(orderFiles);\n            }\n\n            // 放大图片\n            html.find('[data-file-act=\"preview\"]').click(function () {\n                var url = $(this).data('url');\n\n                Dcat.helpers.previewImage(url);\n            });\n\n            formFiles[file.serverId] = file;\n\n            addInput(file.serverId);\n\n            $queue.append(html);\n\n            if (showImg) {\n                setTimeout(function () {\n                    html.css('margin', '5px');\n                }, initImg ? 0 : 400);\n\n                initImg = 1;\n            }\n        }\n\n        // 初始化web-uploader\n        function build() {\n            $wrap = $selector.find(opts.wrapper);\n\n            // 图片容器\n            $queue = $('<ul class=\"filelist\"></ul>').appendTo($wrap.find('.queueList'));\n\n            // 状态栏，包括进度和控制按钮\n            $statusBar = $wrap.find('.statusBar');\n\n            // 文件总体选择信息。\n            $info = $statusBar.find('.info');\n\n            // 上传按钮\n            $upload = $wrap.find('.upload-btn');\n\n            // 没选择文件之前的内容。\n            $placeHolder = $wrap.find('.placeholder');\n\n            $progress = $statusBar.find('.upload-progress').hide();\n\n            // IE;\n            supportIe();\n\n            // 实例化\n            this.uploader = uploader = WebUploader.create(opts.upload);\n\n            // 拖拽时不接受 js, txt 文件。\n            uploader.on('dndAccept', function (items) {\n                var denied = false,\n                    len = items.length,\n                    i = 0,\n                    // 修改js类型\n                    unAllowed = 'text/plain;application/javascript ';\n\n                for (; i < len; i++) {\n                    // 如果在列表里面\n                    if (~unAllowed.indexOf(items[i].type)) {\n                        denied = true;\n                        break;\n                    }\n                }\n\n                return !denied;\n            });\n\n            if (opts.upload.fileNumLimit > 1 && !opts.disabled) {\n                // 添加“添加文件”的按钮，\n                uploader.addButton({\n                    id: addFileButtonSelector,\n                    label: '<i class=\"feather icon-folder\"></i> &nbsp;' + __('go_on_add')\n                });\n            }\n\n            uploader.onUploadProgress = function (file, percentage) {\n                percentages[file.id][1] = percentage;\n                updateTotalProgress();\n            };\n\n            uploader.onBeforeFileQueued = function (file) {\n\n            };\n\n            // 添加文件\n            uploader.onFileQueued = function (file) {\n                fileCount++;\n                fileSize += file.size;\n\n                if (fileCount === 1) {\n                    $placeHolder.addClass('element-invisible');\n                    $statusBar.show();\n                }\n\n                addFile(file);\n                setState('ready');\n                updateTotalProgress();\n\n                if (!opts.disabled && opts.autoUpload) {\n                    // 自动上传\n                    uploader.upload()\n                }\n            };\n\n            // 删除文件事件监听\n            uploader.onFileDequeued = function (file) {\n                fileCount--;\n                fileSize -= file.size;\n\n                if (!fileCount && !Dcat.helpers.len(formFiles)) {\n                    setState('pedding');\n                }\n\n                removeUploadFile(file);\n            };\n\n            uploader.on('all', function (type, obj, reason) {\n                switch (type) {\n                    case 'uploadFinished':\n                        setState('confirm');\n                        updateFileColumn();\n                        break;\n\n                    case 'startUpload':\n                        setState('uploading');\n                        break;\n\n                    case 'stopUpload':\n                        setState('paused');\n                        break;\n                    case  'uploadAccept':\n                        // 上传失败，返回false\n                        //正常来说上传返回必须是个json 必须包含 reason.id  否则肯定出错了\n                        if (!reason || !reason.id) {\n                            var errorMessage;\n                            if (reason && reason.data && reason.data.message) {\n                                errorMessage = reason.data.message\n                            } else if(reason && reason.error) {\n                                errorMessage = reason.error.message //DCAT 原有的逻辑\n                            } else {\n                                errorMessage = \"Unknown error!\"\n                            }\n\n                            Dcat.error(errorMessage);\n\n                            faildFiles[obj.file.id] = obj.file;\n\n                            return false;\n                        }\n\n                        if (reason.merge) {\n                            // 分片上传\n                            return;\n                        }\n\n                        // 上传成功，保存新文件名和路径到file对象\n                        obj.file.serverId = reason.id;\n                        obj.file.serverName = reason.name;\n                        obj.file.serverPath = reason.path;\n                        obj.file.serverUrl = reason.url || null;\n\n                        appendUploadedFile(obj.file);\n\n                        addInput(reason.id);\n\n                        var $li = getFileView(obj.file.id);\n\n                        if (!showImg) {\n                            $li.find('.file-action').hide();\n                            $li.find('[data-file-act=\"delete\"]').show();\n                        }\n\n                        if (opts.sortable) {\n                            $li.find('[data-file-act=\"order\"]').removeClass('d-none').show();\n                        }\n\n                        break;\n                }\n\n            });\n\n            uploader.onError = function (code) {\n                switch (code) {\n                    case 'Q_TYPE_DENIED':\n                        Dcat.error(__('Q_TYPE_DENIED'));\n                        break;\n                    case 'Q_EXCEED_NUM_LIMIT':\n                        Dcat.error(__('Q_EXCEED_NUM_LIMIT', {num: opts.upload.fileNumLimit}));\n                        break;\n                    case 'F_EXCEED_SIZE':\n                        Dcat.error(__('F_EXCEED_SIZE'));\n                        break;\n                    case 'Q_EXCEED_SIZE_LIMIT':\n                        Dcat.error(__('Q_EXCEED_SIZE_LIMIT'));\n                        break;\n                    case 'F_DUPLICATE':\n                        Dcat.warning(__('F_DUPLICATE'));\n                        break;\n                    default:\n                        Dcat.error('Error: ' + code);\n                }\n\n            };\n\n            $upload.on('click', function () {\n                if ($(this).hasClass('disabled')) {\n                    return false;\n                }\n\n                if (state === 'ready') {\n                    uploader.upload();\n                } else if (state === 'paused') {\n                    uploader.upload();\n                } else if (state === 'uploading') {\n                    uploader.stop();\n                }\n            });\n\n            $info.on('click', '.retry', function () {\n                uploader.retry();\n            });\n\n            $info.on('click', '.ignore', function () {\n                for (var i in faildFiles) {\n                    uploader.removeFile(i, true);\n                    delete faildFiles[i];\n                }\n\n            });\n\n            setState('init');\n        }\n\n        // 预览\n        function preview() {\n            for (var i in opts.preview) {\n                var path = opts.preview[i].path, ext;\n\n                if (path.indexOf('.')) {\n                    ext = path.split('.').pop();\n                }\n\n                var file = {\n                    serverId: opts.preview[i].id,\n                    serverUrl: opts.preview[i].url,\n                    serverPath: path,\n                    ext: ext,\n                    fake: 1,\n                };\n\n                setState('incrOriginalFileNum');\n                setState('decrFileNumLimit');\n\n                appendUploadedFileForm(file);\n                appendUploadedFile(file);\n            }\n        }\n\n        this.uploader = uploader;\n        this.options = opts;\n        this.build = build;\n        this.preview = preview;\n        this.setState = setState;\n        this.refreshButton = refreshButton;\n        this.getFileView = getFileView;\n        this.getFileViewSelector = getFileViewSelector;\n        this.addFileView = addFile;\n        this.removeUploadFileView = removeUploadFile;\n        this.isImage = isImage;\n        this.getColumn = function () {\n            return updateColumn;\n        };\n\n        function supportIe() {\n            if (!WebUploader.Uploader.support('flash') && WebUploader.browser.ie) {\n\n                // flash 安装了但是版本过低。\n                if (flashVersion) {\n                    (function (container) {\n                        window['expressinstallcallback'] = function (state) {\n                            switch (state) {\n                                case 'Download.Cancelled':\n                                    break;\n\n                                case 'Download.Failed':\n                                    Dcat.error('Install failed!');\n                                    break;\n\n                                default:\n                                    Dcat.success('Install Success！');\n                                    break;\n                            }\n                            delete window['expressinstallcallback'];\n                        };\n\n                        var swf = './expressInstall.swf';\n                        // insert flash object\n                        var html = `<object type=\"application/x-shockwave-flash\" data=\"${swf}\" `;\n\n                        if (WebUploader.browser.ie) {\n                            html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\n                        }\n\n                        html += `width=\"100%\" height=\"100%\" style=\"outline:0\">\n                            <param name=\"movie\" value=\"${swf}\" />\n                            <param name=\"wmode\" value=\"transparent\" />\n                            <param name=\"allowscriptaccess\" value=\"always\" />\n                            </object>`;\n\n                        container.html(html);\n\n                    })($wrap);\n\n                } else {\n                    $wrap.html('<a href=\"http://www.adobe.com/go/getflashplayer\" target=\"_blank\" border=\"0\"><img alt=\"get flash player\" src=\"http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg\" /></a>');\n                }\n\n                return;\n            } else if (!WebUploader.Uploader.support()) {\n                Dcat.error('您的浏览器不支持Web Uploader！');\n                return;\n            }\n        }\n\n        return this;\n    }\n\n    Dcat.Uploader = function (options) {\n        return new Uploader(options)\n    };\n\n})(window, jQuery);\n"],"sourceRoot":""}